# 보안

## 공동 책임 모델

AWS에서 비즈니스 보안은 AWS와 고객 모두가 책임집니다. AWS는 고객의 환경을 단일 객체로 생각하지 않고 다른 부분들이 서로를 기반으로 구축된 일종의 모음이라고 생각합니다. AWS에서는 일부 객체의 보안을 전적으로 책임지고 나머지 객체의 보안은 고객이 전적으로 책임집니다. 이를 공동 책임 모델이라고 합니다.

EC2 인스턴스를 예로 들면 EC2는 물리적 건물 안에 있으며 데이터 센터의 보안이 유지되어야 합니다. 고객의 인스턴스를 지원하는 네트워크 및 하이퍼바이저가 있습니다. 또 개별 운영 체제도 존재하고 운영 체제에는 애플리케이션이 있으며 애플리케이션은 데이터를 지원합니다. 따라서 EC2와 AWS가 제공하는 모든 서비스에는 서로 다른 부분 위에 쌓여 구축되는 비슷한 형태가 존재합니다.

먼저 물리적 계층을 살펴보면 데이터 센터가 존재하는 건물, 울타리, 24시간 순찰할 경비원이 해당합니다. 이는 AWS가 전담합니다. 물리 계층 위에는 네트워크와 하이퍼바이저가 있습니다. AWS는 이러한 기술을 재창조하여 속도를 높이고, 강화하고, 변조를 방지합니다.

운영 체제는 고객이 보안을 담당합니다. AWS는 시스템에 백도어를 설치하지 않으며 오직 고객만 암호화 키를 소유합니다. 고객만이 OS 루트에 로그인하거나 사용자 계정을 만들 수 있습니다. OS 위에서 실행되는 애플리케이션도 고객이 소유하고 유지 관리합니다.

데이터는 언제나 고객이 제어해야 하는 영역입니다. 애플리케이션 유형에 따라 데이터가 공개되어야 하는 경우도 있고 공개되지 않아야하는 경우도 있습니다. AWS는 각 사용자에게 필요한 도구 모음을 제공합니다. 데이터를 승인된 일부에게만 공개할 수도 있고 모두에게 공개하거나 특정 1명에게만 공개하거나 아무도 액세스하지 못하도록 잠글 수도 있습니다.

기본적으로 AWS는 클라우드 자체의 보안을 책임지며 고객은 클라우드 내부의 보안을 책임집니다.

---

## 사용자 권한 및 액세스

AWS 계정을 생성하면 루트 계정 사용자라는 자격이 부여됩니다. 루트 사용자는 AWS 계정의 소유자이며 해당 계정에서 원하는 일은 무엇이든 할 수 있습니다.

AWS로 서비스를 구축하고 운영하다보면 서비스에 접근할 수 있는 사용자의 권한 범위를 지정하고 싶으실 겁니다. AWS Identity and Access Management, 즉 IAM을 사용하면 액세스 권한을 세부적으로 제어할 수 있습니다.

IAM에서는 IAM 사용자를 만들 수 있습니다. 생성된 IAM 사용자는 기본적으로 어떤 권한도 없습니다. 처음에는 AWS 계정에 로그인할 수도 없습니다. 해당 계정에서 작업하려면 사용자 권한을 명시적으로 부여해야 합니다. 사용자에게 필요한 곳에 대한 액세스 권한만 부여해야 하며 이 개념을 최소 권한 원칙이라고 합니다.

권한을 부여하거나 거부하려면 IAM 정책이라고 하는 요소를 IAM 사용자에 연결해야 합니다. IAM 정책은 사용자가 할 수 있거나 없는 API 호출을 설명하는 JSON 문서입니다.

사용자 권한을 더 쉽게 관리하기 위해서 IAM 그룹을 사용하여 그룹을 분류할 수 있습니다. 정책을 그룹에 연결하면 그룹의 모든 사용자가 해당 권한을 갖게 됩니다. 특정 서비스에 대한 액세스 권한을 개별적으로 부여하는 대신 그룹으로 분류해 해당 그룹원들에게 권한을 한 번에 부여할 수 있습니다.

---

## AWS Organizations

AWS에서 권한은 합류하는 모든 사람에게 다른 선택지를 제공할 수 있습니다. 권한을 부여하다보면 AWS 계정이 스파게티처럼 복잡하게 얽히게 될 가능성이 높습니다. 예를 들어 계정 A, F, G를 추적해야 하거나 B에 잘못된 권한이 있거나 계정 C에 결재 및 규정 준수 정보가 있기도 합니다. 순서를 정비하고 특정 계정에서 특정 기능을 수행할 수 있는 사람을 지정하는 방법 중 하나는 AWS Organizations라는 서비스를 사용하는 것입니다.

Organizations는 여러 AWS 계정을 관리하는 중앙 위치라고 생각하면 됩니다. 계정 전체에서 결제 제어, 액세스, 규정 준수 및 보안을 관리하고 리소스를 공유할 수 있습니다.

Organizations의 주요 기능 중 첫 번째는 계정의 중앙 집중식 관리입니다. 계정을 하나의 조직으로 결합해 계정을 중앙에서 관리할 수 있습니다. 다음은 모든 멤버 계정에 대한 통합 결재입니다. 조직의 기본 계정을 사용하여 모든 멤버 계정을 통합해 비용을 지불할 수 있습니다. 통합 결재의 장점은 요금의 대량 할인이 가능하다는 점입니다.

다음 기능은 보안, 규정 준수 또는 예산 요구 사항에 맞게 계정의 계층적 그룹화를 구현할 수 있다는 점입니다. 계정을 조직 단위인 OU나 비즈니스 단위인 BU로 그룹화할 수 있습니다. 예를 들어 특정 규정 준수 요구 사항을 충족하는 AWS 서비스에만 액세스해야 하는 계정이 있다면 이 계정을 하나의 OU에 넣을 수 있으며 개발자 OU에 해당하는 계정이 있다면 그에 맞게 그룹화하는 식입니다.

마지막 주요 기능은 조직 기본 계정의 관리자로서 AWS 서비스 및 API 작업을 제어하는 기능입니다. 서비스 제어 정책, 즉 SCP를 사용하여 조직 내 멤버 계정에 최대 권한을 지정할 수 있습니다. SCP를 사용하면 각 멤버 계정에서 액세스할 수 있는 AWS 서비스, 리소스, 개별 API 작업, 사용자 및 역할을 제한할 수 있다는 점입니다.

---

## 규정 준수

회사가 속한 업종에 따라 특정 표준을 준수해야 할 수 있습니다. 감사 또는 검사를 통해 회사가 이러한 표준을 충족하는지 확인합니다.

AWS는 보안 관련 업계 모범 사항을 준수하여 데이터 센터 인프라와 네트워킹을 구축했으며 AWS 고객은 AWS 정책, 아키텍처, 운영 프로세스 관련 모범 사례를 모두 상속하게 됩니다.

AWS는 온라인에서 확인할 수 있는 수많은 보증 프로그램을 준수합니다. 또 다운로드하여 규정 준수 보고서에 사용할 수 있는 다양한 백서와 문서를 제공합니다. 이러한 문서에 액세스할 수 있는 대표적인 방법은 AWS Artifact라는 서비스를 이용하는 겁니다. AWS Artifact를 사용하면 다양한 규정 준수 표준을 충족함이 입증된, 제3자가 작성한 규정 준수 보고서를 확인할 수 있습니다.

AWS의 기본 플랫폼은 안전하며 Artifact 같은 서비스와 백서를 통해 사용자가 충족해야 하는 규정 준수 요구 사항 유형에 관한 문서를 제공합니다. 하지만 AWS에서 구축하는 이외의 항목은 사용자의 책임입니다. 사용자는 자신이 구축하는 애플리케이션과 솔루션의 아키텍처를 제어해야 하며 규정 준수와 보안, 공유 책임 모델을 염두에 두고 구축해야 합니다.

---

## 서비스 거부 공격

시스템이 작동하지 못할 때까지 과부하를 걸어 애플리케이션의 기능을 정지시키는 DDoS 분산 서비스 거부 공격이 있습니다.

정상적으로 작동할 때 애플리케이션은 고객의 요청을 수신하여 결과를 반환합니다. DDoS 공격에서는 해커가 애플리케이션 용량 과부하를 시도하여 기본적으로 모든 사람의 서비스 이용을 처리할 수 없게 만듭니다. 하지만 장치 한 대로 공격하면 충분한 타격을 줄 수 없기 때문에 인터넷에 연결된 다른 장치를 활용하여 그 장치가 자신도 모르는 사이에 사용자의 인프라를 공격하게 합니다.

구체적인 공격 사례로는 UDP flood 같은 저수준 무작위 공격부터 HTTP 수준 공격으로 정상적인 고객처럼 보이는 사람이 복잡한 제품 검색 같은 평범한 정보를 계속 요구해 일반적인 고객이 들어갈 수조차 없게 만드는 공격이 있습니다.

AWS에서는 이 같은 공격에 대비하여 여러 솔루션을 사용할 수 있습니다. 우선 UDP flood 같은 저수준 네트워크 공격의 경우 보안 그룹을 이용하여 목록에 없는 트래픽이라면 서버와 통신할 수 없게 만들 수 있습니다.

HTTP 수준의 공격인 Slowloris 공격은 Elastic Load Balancer를 이용해 해결할 수 있습니다. ELB는 http 트래픽 요청을 먼저 처리해 속도에 상관없이 모든 메시지가 완료될 때까지 기다린 다음 프런트 엔드 웹 서버로 전송합니다. 압도하려고 시도할 수 있지만 ELB는 리전 수준에서 실행됩니다. ELB를 압도하기 위해선 전체 AWS 리전을 압도해야 합니다. 이론적으로 불가능하지는 않지만 평범한 사람이 성공하기에는 비용이 너무 많이 듭니다.

또 AWS WAF를 이용하는 AWS Shield라는 예리하고 정교한 공격에 특화된 방어 도구를 제공합니다. AWS Shield는 방대한 기계 학습 기능을 지원하며 진화하는 새로운 위협을 인식할 수 있고 계속 증가하는 파괴적인 벡터 목록으로부터 사용자의 시스템을 사전 예방적으로 방어할 수 있습니다.

AWS Shield Advanced라는 유료 서비스를 활용하면 CloudFront, Route53, ELB 같은 서비스와 통합하여 복잡한 DDoS 공격을 탐지하고 완화할 수 있습니다. 또한 복잡한 DDoS 공격을 완화하기 위한 사용자 지정 규칙을 작성하여 AWS Shield를 AWS WAF와 통합할 수 있습니다.

---

## 추가 보안 서비스

AWS는 저장 중 암호화와 전송 중 암호화라는 두 가지 변형으로 암호화를 제공합니다.

### AWS Key Management Service(AWS KMS)

AWS KMS를 사용하면 암호화 키를 사용하여 암호화 작업을 수행할 수 있습니다. 암호화 키는 데이터 잠금(암호화) 및 잠금 해제(암호 해독)에 사용되는 임의의 숫자 문자열입니다. AWS KMS를 사용하여 암호화 키를 생성, 관리 및 사용할 수 있습니다. 또한 광범위한 서비스 및 애플리케이션에서 키 사용을 제어할 수 있습니다.

### AWS WAF

AWS WAF는 웹 애플리케이션으로 들어오는 네트워크 요청을 모니터링할 수 있는 웹 애플리케이션 방화벽입니다.

AWS WAF는 CloudFront 및 Application Load Balancer와 함께 작동합니다.

애플리케이션이 여러 IP 주소에서 악의적인 네트워크 공격을 받고 있다고 가정해보겠습니다. 이러한 요청이 애플리케이션에 계속 액세스하는 것을 방지해야 하지만 합법적인 사용자는 애플리케이션에 액세스할 수 있도록 해야 합니다. 지정한 IP 주소에서 나온 요청을 제외한 모든 요청을 허용하도록 웹 ACL을 구성합니다.

AWS WAF는 요청이 들어오면 웹 ACL에서 구성한 규칙 목록을 확인합니다. 요청이 차단된 IP 주소 중 하나에서 나온 것이 아니면 액세스가 허용됩니다.

그러나 웹 ACL에서 지정한 차단 IP 주소 중 하나에서 요청이 나왔으면 액세스가 거부됩니다.

### Amazon Inspector

자동화된 보안 평가를 실행하여 애플리케이션의 보안 및 규정 준수를 개선할 수 있는 서비스입니다. EC2 인스턴스에 대한 오픈 액세스, 취약한 소프트웨어 버전 설치와 같은 보안 모범 사례 위반 및 보안 취약성을 애플리케이션에서 검사합니다.

Inspector는 평가 후 보안 탐지 결과 목록을 제공합니다. 이 목록은 심각도 수준에 따라 우선 순위가 결정되고 각 보안 문제에 대한 자세한 설명 및 권장 해결 방법이 포함됩니다. 그러나 AWS는 제공된 권장 사항으로 모든 잠재적 보안 문제가 해결됨을 보장하지는 않습니다.

### Amazon GuardDuty

AWS 인프라 및 리소스에 대한 지능형 위협 탐지 기능을 제공하는 서비스입니다. 이 서비스는 AWS 환경 내의 네트워크 활동 및 계정 동작을 지속적으로 모니터링하여 위협을 식별합니다.
