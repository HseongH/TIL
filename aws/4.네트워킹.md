# 4. 네트워킹

Amazon Virtual Private Cloud(VPC)를 사용하면 사용자가 정의한 가상 네트워크에서 AWS 리소스를 실행할 수 있는 논리적으로 격리된 AWS 클라우드 섹션을 프로비저닝할 수 있습니다. 이러한 리소스는 인터넷을 통해 일반적으로 접근할 수 있는 퍼블릭 리소스일 수도 있고, 인터넷을 통해 접근할 수 없는 프라이빗 리소스일 수도 있습니다.

## AWS와의 연결

### Amazon Virtual Private Cloud(Amazon VPC)

한 서비스에 EC2 인스턴스가 수백만 개 존재하고 모든 리소스 간에 경계가 없으면 네트워크 트래픽이 제한 없이 리소스 간에 흐를 수 있습니다.

AWS 리소스 간에 경계를 설정하는 데 사용할 수 있는 네트워킹 서비스가 Amazon VPC입니다.

VPC를 사용해 AWS 클라우드의 격리된 섹션을 프로비저닝할 수 있고 이 격리된 섹션에서는 사용자가 정의한 가상 네트워크에서 리소스를 시작할 수 있습니다.

### 인터넷 게이트웨이

퍼블릭 트래픽이 VPC에 액세스할 수 있도록 허용하려면 인터넷 게이트웨이를 VPC에 연결해야 합니다.

인터넷 게이트웨이는 VPC와 인터넷 간의 연결로 고객이 드나드는 출입문이라고 할 수 있습니다. 인터넷 게이트웨이가 없다면 아무도 VPC 내의 리소스에 액세스할 수 없습니다.

### 가상 프라이빗 게이트웨이

VPC 내의 비공개 리소스에 액세스하려면 가상 프라이빗 게이트웨이를 사용할 수 있습니다.

가상 프라이빗 게이트웨이는 보호된 인터넷 트래픽이 VPC로 들어오도록 허용하는 구성 요소입니다. 가상 프라이빗 게이트웨이는 승인된 네트워크에서 나오는 트래픽만 VPC로 들어가도록 허용합니다.

### AWS Direct Connect

퍼블릭 트래픽과 프라이빗 트래픽이 구분되었지만 둘은 기본적으로 많은 사용자와 대역폭을 공유하는 일반적인 인터넷 연결을 사용합니다. 서비스 사용률이 높은 경우에는 프라이빗 트래픽도 네트워크 병목현상이 발생합니다.

AWS Direct Connect는 데이터 센터와 VPC 간에 비공개 전용 연결을 설정하는 서비스입니다. 별도의 인터넷 연결을 사용하기 때문에 네트워크 병목현상도 발생하지 않고 비용도 절감할 수 있으며 네트워크를 통과할 수 있는 대역폭을 늘리는 데에도 도움이 됩니다.

---

## 서브넷 및 네트워크 엑세스 제어 목록

VPC에서는 게이트웨이에 대한 엑세스 관리를 위해 서브넷을 사용해야 합니다. 퍼블릭 서브넷은 인터넷 게이트웨이에 액세스할 수 있지만 프라이빗 서브넷은 그렇지 않습니다. 서브넷은 트래픽 권한도 제어하는데 서브넷 경계를 지나는 모든 패킷은 ACL(네트워크 액세스 제어 목록)에서 검사됩니다.

네트워크 ACL은 여권 심사관과 같이 승인 목록에 있는 패킷인지 확인해 목록에 있다면 액세스를 허용해줍니다. 승인 목록에 없거나 승인 금지 목록에 존재하는 경우 차단당합니다. 또 트래픽이 나갈 때도 검사를 실시하는데 승인된 트래픽은 나갈 수 있지만 유해할지도 모르는 트래픽은 대상을 건드리기도 전에 차단됩니다.

ACL은 서브넷 경계를 지나는 패킷만 평가하기 때문에 모든 네트워크 제어 문제를 해결하진 못합니다. 같은 서브넷에 여러 인스턴스가 존재할 때도 있지만 메시지 전송자와 메시지를 전송할 수 있는 포트에 관해서는 다른 규칙이 적용됩니다. 따라서 인스턴스 수준의 네트워크 보안도 필요합니다.

인스턴스 수준 액세스 문제를 해결하기 위해 AWS에서는 보안 그룹을 도입했습니다. 모든 EC2 인스턴스는 시작되면 자동으로 보안 그룹으로 이동합니다. 기본적으로 보안 그룹은 모든 트래픽이 인스턴스로 이동하지 못하게 합니다. 안전하지만 유용성이 떨어질 수 있습니다. 사용자는 특정 유형의 트래픽을 수락하도록 보안 그룹을 수정해 일부 트래픽의 액세스를 허용할 수 있습니다.
보안 그룹은 문지기와 같이 목록을 참조하여 인스턴스에 접근할 수 있는지를 확인해 진입을 통제하지만 나갈 때는 통제하지 않습니다. 따라서 보안그룹에 들어온 모든 트래픽은 나갈 수 있습니다.

보안 그룹과 ACL 간의 차이는 보안 그룹은 상태 저장이라는 점입니다. 보안그룹은 출입이 허용된 트래픽은 항상 기억하고 있습니다. 따라서 한번 허용된 패킷에 대한 검사는 다시 실시하지 않습니다. 반면 ACL은 상태 비저장입니다. 아무것도 기억하지 않고 상황과 무관하게 경계를 지나는 모든 패킷을 확인합니다.

---

## 글로벌 네트워크

AWS는 고객이 배포된 AWS 인프라와 상호작용하는 것을 돕기위해 Route 53, Amazon CloudFront 두 서비스를 제공합니다.

Route 53은 Domain Name Service 즉, DNS로 웹 사이트의 이름을 IP 주소로 번역해주는 서비스입니다. 뿐만아니라 트래픽을 지연 시간 기반 라우팅, 지리적 위치 DNS, 지역 근접성, 가중치 기반 라운드 로빈 같은 라우팅 정책을 사용하여 서로 다른 엔드포인트로 보낼 수 있습니다. 지리적 위치 DNS를 사용한다면 트래픽을 고객 위치 기준으로 전달하게 됩니다. 예를 들어 북미에서 오는 트래픽이 오리건 리전으로 라우팅되고 아일랜드의 트래픽이 더블린 리전으로 라우팅되는 식입니다. Route 53은 도메인 이름을 등록하고 관리하는 데에도 사용할 수 있습니다.

Amazon CloudFront는 웹 사이트 자산을 고객에게 전달하는 속도를 높여주는 서비스로 엣지 로케이션을 활용하여 고객과 최대한 가까운 곳으로 콘텐츠를 제공합니다.
