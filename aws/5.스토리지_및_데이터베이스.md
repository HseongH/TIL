# 스토리지 및 데이터베이스

## 인스턴스 스토어 및 Amzon Elastic Block Service(Amazon EBS)

EC2 인스턴스를 사용하면 인스턴스 유형에 따라 스토어 볼륨이라는 로컬 저장소를 사용할 수 있습니다. 스토어 볼륨은 EC2 인스턴스가 실행되는 호스트에 물리적으로 연결되며 일반 하드 드라이브처럼 바로 작성할 수 있습니다. EC2 인스턴스는 가상 컴퓨터 머신으로 중단 후 새로 시작했을 때 이전과 다른 호스트에 연결될 수 있습니다. 따라서 스토어 볼륨은 인스턴스와 생명주기를 같이하며 인스턴스를 중단 및 시작하게 되면 이전에 스토어 볼륨에 저장되어 있던 데이터가 모두 삭제될 수 있습니다. 이러한 특성때문에 스토어 볼륨에는 휘발성으로 관리할 수 있는 데이터인 임시 파일, 스크래치 데이터 등 새로 생성하는데 부작용이 없는 데이터만을 저장하는 것이 좋습니다.

지속적으로 저장되어 관리되어야 하는 데이터는 Amazon Elastic Block Service(Amazon EBS)라는 서비스에 저장할 수 있습니다. EBS를 사용하면 EBS 볼륨이라는 가상 하드 드라이브를 만들어 EC2 인스턴스에 연결할 수 있습니다. EBS 볼륨은 다양한 크기와 유형으로 제공되며 생성할 때 사용자가 원하는만큼 크기, 유형, 구성을 설정해 사용할 수 있습니다. EBS는 로컬 인스턴스 스토어 볼륨과는 다른 드라이브로 인스턴스가 중단 및 시작상태로 전환되어도 데이터가 그대로 유지됩니다.

EBS 볼륨을 사용하면 스냅샷이라고 하는 데이터 증분 백업을 만들어 드라이브가 손상되는 등의 경우에도 쉽게 데이터를 복구할 수 있습니다. 증분 백업은 전체 백업과 달리 백업이 실행될 때마다 변경된 데이터만을 백업해 데이터 블록으로 저장하는 것을 말합니다.

---

## Amazon Simple Storage Service(Amazon S3)

Amazon S3는 객체의 형태로 파일을 저장하고 파일 디렉터리의 개념인 버킷에 각 객체들을 저장하는 스토리지 서비스입니다. S3에 저장할 수 있는 객체의 최대 크기는 5TB이며 객체에 버전을 지정해 실수로 삭제되는 일을 방지할 수도 있습니다. 또 객체를 보거나 액세스할 수 있는 사람을 제한하는 권한도 설정할 수 있습니다.

S3에는 다양한 사용 사례에 맞는 메커니즘을 제공합니다.

우선 S3 Standard 입니다. S3 Standard는 99.999999999%의 내구성을 제공하는 서비스입니다. 데이터가 3개 이상의 가용 영역에 저장되기 때문에 동시 데이터 손실을 감당할 수 있습니다.

- 자주 액세스하는 데이터용으로 설계
- 최소 3개의 가용 영역에 데이터 저장

S3 Infrequent Acess는 자주 액세스되지는 않지만 필요할 떄는 빠르게 액세스해야 하는 데이터를 저장할 때 사용합니다. 백업, 재해 복구 파일 또는 장기 보관이 필요한 모든 객체에 안성맞춤입니다.

- 자주 액세스하지 않는 데이터에 적합
- S3 Standard와 비슷하지만 스토리지 가격은 더 저렴하고 검색 가격은 더 높음

S3 One Zone-Infrequent Access(S3 One Zone-IA)는 단일 가용 영역에 데이터를 저장합니다. 따라서 스토리지 비용을 절감하려는 경우, 가용 영역에 장애가 발생할 경우 데이터를 손쉽게 재현할 수 있는 경우에 적용할 수 있는 스토리지 클래스 입니다.

- 단일 가용 영역에 데이터를 저장
- S3 Standard-IA보다 낮은 스토리지 가격

S3 Intelligent-Tiering은 사용자가 객체에 30일 연속 액세스하지 않으면 해당 객체를 Standard-IA로 이동시키고, IA에 저장된 객체에 액세스하면 자동으로 Standard로 이동시키는 스토리지 클래스입니다.

- 액세스 패턴을 알 수 없거나 자주 변화하는 데이터에 이상적
- 객체당 소량의 월별 모니터링 및 자동화 요금을 부과

S3 Glacier는 데이터 보관에 이상적인 저비용 스토리지 클래스입니다.

- 데이터 보관용으로 설계된 저비용 스토리지
- 객체를 몇 분에서 몇 시간 이내에 검색

S3 Glacier Deep Archive는 Glacier와 비슷하지만 스토리지에 저장된 객체를 12시간 이내에 검색할 수 있다는 차이점이 있습니다. 보관된 객체를 더 빨리 검색해야 한다면 S3 Glacier 스토리지 클래스를 사용해야 합니다.

- 보관에 이상적인 가장 저렴한 객체 스토리지 클래스
- 객체를 12시간 이내에 검색

---

## Amazon EBS와 Amazon S3 비교

### Amazon EBS

EBS는 블록 스토리지로 최대 16TiB의 저장 공간을 제공하며 EC2 인스턴스가 종료되어도 데이터가 그대로 유지되고 HDD와 SSD를 모두 제공합니다.

### Amazon S3

S3는 객체 스토리지로 무제한 저장 공간을 제공하며, 하나의 객체는 최대 5TB까지 저장할 수 있습니다. 한 번 쓰기 / 여러 번 읽기(WORM)에 특화되어 있으며 99.999999999%의 내구성을 자랑합니다.

사진 분석 웹 사이트를 운영한다고 가정해보겠습니다. 사용자가 사진을 업로드하면 비슷한 동물을 찾아주는 사이트입니다. 동물 사진 수백만 장을 인덱싱하고 이 사진을 사용자 수천 명이 동시에 볼 수 있어야 합니다. 이 경우에는 S3가 더 효율적입니다. S3는 이미 웹을 지원합니다. 모든 객체에 URL이 있으며 이미지를 보거나 관리할 수 있는 사람에 대한 액세스 권한을 제어할 수 있습니다. 리전별로 분산되어 있어 높은 내구성을 자랑해 백업 전략을 따로 고민할 필요가 없습니다. 또 EBS에서 동일한 스토리지 로드를 실행하는 데 비해 비용 절감 효과가 뛰어납니다. 서버리스이기 때문에 EC2 인스턴스가 필요하지도 않습니다.

오류를 수정해야 하는 80GB의 동영상 파일이 있다고 가정해보겠습니다. S3의 객체 스토리지는 모든 파일을 완성된 개별 객체로 취급하기 때문에 객체가 변경될 때마다 전체 파일을 다시 업로드해야 합니다. 하지만 EBS와 같은 블록 스토리지는 파일을 하나의 작은 구성 요소 즉 블록으로 나눕니다. 80GB의 동영상을 편집하고 업로드하면 해당 비트가 있는 블록만 업데이트합니다. 이 경우에는 EBS를 사용하는 것이 더 효율적입니다.

완성 객체를 사용하거나 변경 횟수가 적다면 S3를 사용하는 것이 효율적이고 복잡한 읽기, 쓰기, 변경 기능을 수행한다면 EBS를 사용해야 합니다. 개별 워크로드에 따라 사용해야 하는 스토리지가 상이합니다.
