# SAP 문제 2번

Q2. 온프레미스 IdP와 함께 SAML 2.0 연동 자격 증명 솔루션을 구현했습니다. 권한이 있는 사용자가 페더레이션 자격 증명 웹 포털을 통해 인증을 테스트하면 AWS 환경에 대한 액세스 권한이 부여되고 권한이 없는 사용자가 인증을 시도하면 액세스가 거부되어야 합니다. ID 페더레이션 속성이 구성되어 있는지 확인해야 하는 사항은 무엇입니까?

A.

- 페더레이션 사용자 또는 페더레이션 그룹의 신뢰 정책에 대해 생성된 IAM 역할은 SAML 공급자를 기준으로 설정했습니다.
- 웹 포털은 SAML 공급자의 ARN, IAM 역할의 ARN 및 IdP의 SAML 어설션을 사용하여 AWS STS 가정 역할을 호출합니다.
- 회사의 IdP는 사용자 또는 그룹이 회사를 적절한 권한이 있는 IAM 역할에 속성 매핑하는 SAML 어설션을 정의합니다.

---

조직의 IdP와 AWS 계정이 서로를 신뢰하도록 구성해야 합니다.

1. IdP로 AWS를 등록합니다. 조직의 IdP에서 다음 URL에서 얻는 SAML 메타데이터 문서를 사용해 AWS를 서비스 공급자로(SP)로 등록합니다.

```
https://signin.aws.amazon.com/static/saml-metadata.xml
```

2. IdP를 사용해 AWS에서 IdP를 IAM 자격 증명 공급자로 기술하는 동등한 메타데이터 XML파일을 생성합니다. 파일에는 발급자 이름, 생성 일자, 만료 일자 및 AWS가 조직에서 오는 인증 응답의 유효성을 검증하는 데 사용할 수 있는 키가 포함되어 있어야 합니다.

3. IAM 콘솔에서 SAML 자격 증명 공급자 엔터티를 생성합니다. 2단계에서 IdP가 생성한 SAML 메타데이터 문서를 업데이트합니다.

4. IAM에서 하나 이상의 IAM 역할을 생성합니다. 역할의 신뢰 정책에서 SAML 공급자를 보안 주체로 설정함으로써 조직과 AWS 사이에 신뢰 관계를 설정합니다. 역할의 권한 정책은 조직의 사용자가 AWS에서 하도록 허용된 것을 설정합니다.

5. 조직의 IdP에서 조직의 사용자 또는 그룹을 IAM 역할로 매핑하는 어설션을 정의합니다.

6. 애플리케이션에서 AWS Security Token Service `AssumeRoleWithSAML` API를 호출해 3단계에서 생성한 SAML 공급자의 ARN, 4단계에서 생성한 수임할 역할의 ARN 및 IdP에서 얻는 현재 사용자에 대한 SAML 어설션으로 전달합니다. AWS는 역할 수임 요청이 SAML 공급자에서 참조된 IdP로부터 오는지 확인합니다.

7. 요청이 성공하면 API는 일련의 임시 보안 자격 증명을 반환하고 애플리케이션은 이를 사용해 AWS에 서명된 요청을 보냅니다.

ARN은 Amazon Resource Name으로 AWS 리소스를 고유하게 식별하는 역할을 합니다.
