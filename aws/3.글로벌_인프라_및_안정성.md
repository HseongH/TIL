# 글로벌 인프라 및 안정성

애플리케이션의 모든 리소스가 저장된 대규모 데이터 센터가 한 군데만 존재한다면 그 지역에 지진같은 자연재해가 발생할 경우 모든 사용자의 애플리케이션이 동시에 중단됩니다. 애플리케이션에 고가용성과 내결함성이 보장되어야 하는데 AWS는 리전이라는 형태로 전 세계 곳곳에서 운영되고 있습니다.

## 리전 선택

아키텍처를 구성하기 전 서비스가 실행될 리전을 선택해야 합니다. 규정 준수, 근접성, 가용 서비스, 금액 네 가지 고려사항이 있습니다.

첫 번째는 규정 준수입니다. 다른 요인보다 우선적으로 고려해야할 사항입니다. 데이터가 영국을 벗어나면 안된다는 요구 사항이 있다면 다른 고민할 필요 없이 런던 리전을 선택해야 합니다.

두 번째로 고객과의 근접성을 고려해야 합니다. 고객과의 물리적 거리가 멀수록 응답에 지연이 발생합니다. 회사는 워싱턴 DC에 있고 고객은 싱가포르에 주로 거주한다면 회사와 가까운 버지니아 북부 리전을 선택할지 고객과 가까운 싱가포르 리전을 선택할지 고려해야 합니다.

세 번째로 사용하고자 하는 서비스가 해당 리전에 존재하는지 고려해야 합니다. 모든 리전에 서비스를 구축하기 위해서는 AWS가 제작해야 하는 물리적 하드웨어가 많이 필요할 수 있습니다. 추후에 기능이 추가되긴 하겠지만 당장 사용해야 하는 서비스라면 서비스가 존재하는 리전을 선택해야 합니다.

네 번째는 가격입니다. 브라질과 같은 일부 국가의 세금 구조 때문에 동일한 인스턴스를 사용하여도 다른 리전에 비해 비용이 더 발생할 수 있습니다. 상파울루 리전은 오레곤 리전과 동일한 워크로드를 실행하는데 비용이 50% 더 많이 과금될 수 있습니다. 가격이 가장 중요한 고려사항이라면 고객이 브라질에서 주로 사용하여도 다른 국가의 리전을 선택해야합니다.

---

## 가용 영역

하나의 리전에는 단일 데이터 센터 또는 데이터 센터 그룹으로 구성된 가용 영역 줄여서 AZ이 존재합니다. 가용 영역은 서비스를 실행하는데 필요한 예비 전력, 네트워킹 및 연결을 구비한 하나 이상의 독립적인 데이터 센터가 있습니다. 각각의 가용 영역은 수십 키로마일 떨어져있는데 이는 수 밀리세크 정도의 짧은 서비스 지연 시간을 발생시킬 정도로 가깝지만 하나의 가용 영역에 재난이 발생해도 다른 가용 영역에는 영향이 없을 정도로 충분이 떨어져있습니다.

EC2 인스턴스를 하나만 실행한다면 단일 가용 영역에서 실행됩니다. 재난에 대비한 고가용성 서비스를 제공하기 위해선 두개 이상의 가용 영역에서 EC2 인스턴스를 실행해 인프라를 구성해야 합니다.

---

## 엣지 로케이션

데이터는 서울 리전에 존재하지만 뭄바이에서 데이터가 호스팅된다면 어떨까요? 뭄바이에서 서울로 직접 데이터를 요청하거나 본사의 위치를 뭄바이로 옮기는 것보단 서울의 데이터를 그대로 캐싱해 뭄바이에 두고 뭄바이에서 직접 데이터를 전달하는 것이 더 효율적일 것입니다. 이러한 개념을 콘텐츠 딜리버리 네트워크(CDN)라고 부르고 AWS는 CloudFront를 통해 CDN 서비스를 제공합니다. CloudFront는 데이터, 동영상, API 등을 엣지 로케이션을 이용해 전 세계 고객에게 빠르게 제공합니다.

엣지 로케이션은 고객과 가까운 위치에 콘텐츠 사본을 캐시하는 데 사용하는 사이트입니다. 고객이 데이터를 요청하면 CloudFront가 엣지 로케이션에서 캐싱된 데이터를 검색해 고객에게 제공합니다.

---

## AWS 리소스를 프로비저닝하는 방법

AWS의 서비스들은 API 호출을 통해 서로 상호 작용합니다. AWS API에 요청을 주고받는 방법은 AWS CLI를 이용하는 방법, AWS Management Console을 이용하는 방법, AWS SDK를 이용하는 방법이 있습니다.

첫 번째로 AWS Management Console은 유저 인터페이스 서비스로 사용자가 AWS 콘솔에 접근해 마우스 조작으로 인스턴스를 생성하는 방법입니다. AWS 서비스를 처음 사용하거나 관련 지식을 쌓을 때 유용합니다. 또 테스트 환경을 구축하거나, 청구서를 보거나 모니터링할 때도 유용하게 사용할 수 있습니다. 하지만 이렇게 수동으로 프로비저닝하는 방법은 인스턴스를 생성하는 도중에 체크박스를 선택하지 않거나 철자를 틀리게 작성하는 등의 휴먼 에러가 발생할 수 있기 때문에 관리해야할 리소스가 많아지면 이 방식에 의존할 수 없습니다.

두 번째로 CLI를 이용하는 방법입니다. 터미널에서 Command를 입력해 인스턴스를 생성하거나 서비스에 접근할 수 있습니다. 반복되는 명령은 스크립트로 처리하거나 트리거를 생성해 트리거가 감지되면 자동으로 Command를 실행하는 등 자동화 처리가 가능하고 동일한 작업은 미리 작성한 명령을 실행하기만 하면 되기때문에 휴먼 에러를 줄일 수 있습니다.

세 번째로는 소프트웨어 개발 키트(SDK)를 이용하는 방법입니다. 자주 사용하는 개발 언어를 이용해 인스턴스 생성 명령을 작성하고 애플리케이션을 생성하는 등의 작업을 수행할 수 있습니다.

Amazon Elastic Beanstalk은 사용자가 코드 및 구성 설정을 제공하면 용량 조정, 로드 밸런싱, 자동 조정, 애플리케이션 상태 모니터링 등의 작업을 수행하는 데 필요한 리소스를 배포합니다.

Amazon CloudFormation을 사용하여 인프라를 코드로 취급할 수 있습니다. CloudFormation은 리소스를 안전하고 반복 가능한 방식으로 프로비저닝하기 때문에 수작업을 수행하거나 스크립트를 작성할 필요 없이 코드를 작성해 인프라 및 애플리케이션을 구축할 수 있습니다. 스택을 관리할 때 필요한 적절한 작업을 결정하고 오류가 발생하면 변경 사항을 자동으로 롤백합니다.
